{"ast":null,"code":"import React,{useEffect,useRef,useState,useCallback}from'react';import{createChart,ColorType,CrosshairMode,LineStyle,PriceScaleMode}from'lightweight-charts';import{Cog6ToothIcon,ChartBarIcon,PlayIcon,PauseIcon,MagnifyingGlassIcon,PlusIcon,EyeIcon,EyeSlashIcon,AdjustmentsHorizontalIcon}from'@heroicons/react/24/outline';import DynamicSymbolSearch from'./DynamicSymbolSearch';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TradingChartV3=_ref=>{let{symbol='NQ=F',displaySymbol='NQ',height=600,apiBaseUrl=process.env.REACT_APP_API_BASE_URL||'http://localhost:8000',onSignalReceived,onSymbolChange,onChartDataUpdate}=_ref;const chartContainerRef=useRef(null);const chartRef=useRef(null);const candlestickSeriesRef=useRef(null);const volumeSeriesRef=useRef(null);const indicatorSeriesRefs=useRef({});// Chart state\nconst[isPlaying,setIsPlaying]=useState(true);const[showSymbolSearch,setShowSymbolSearch]=useState(false);const[timeframe,setTimeframe]=useState('5m');const[selectedPeriod,setSelectedPeriod]=useState('1d');const[chartType,setChartType]=useState('candlestick');const[showDrawingTools,setShowDrawingTools]=useState(false);const[showIndicatorSearch,setShowIndicatorSearch]=useState(false);const[indicatorSearchTerm,setIndicatorSearchTerm]=useState('');// Data state\nconst[chartData,setChartData]=useState([]);const[currentPrice,setCurrentPrice]=useState(null);const[priceChange,setPriceChange]=useState(0);const[tradeSignals,setTradeSignals]=useState([]);const[limitOrders,setLimitOrders]=useState([]);const[isLoading,setIsLoading]=useState(false);const[dataSource,setDataSource]=useState('live');// 'live', 'cached', 'fallback'\n// Real-time update state\nconst[lastUpdateTime,setLastUpdateTime]=useState(0);const[updateCount,setUpdateCount]=useState(0);const[connectionStatus,setConnectionStatus]=useState('disconnected');// WebSocket refs\nconst wsRef=useRef(null);const reconnectTimeoutRef=useRef(null);const updateIntervalRef=useRef(null);// Professional timeframe configuration with proper intervals\nconst timeframes=[{value:'1m',label:'1m',seconds:60,description:'1 Minute'},{value:'3m',label:'3m',seconds:180,description:'3 Minutes'},{value:'5m',label:'5m',seconds:300,description:'5 Minutes'},{value:'15m',label:'15m',seconds:900,description:'15 Minutes'},{value:'30m',label:'30m',seconds:1800,description:'30 Minutes'},{value:'1h',label:'1h',seconds:3600,description:'1 Hour'},{value:'2h',label:'2h',seconds:7200,description:'2 Hours'},{value:'4h',label:'4h',seconds:14400,description:'4 Hours'},{value:'6h',label:'6h',seconds:21600,description:'6 Hours'},{value:'12h',label:'12h',seconds:43200,description:'12 Hours'},{value:'1d',label:'1D',seconds:86400,description:'1 Day'},{value:'1wk',label:'1W',seconds:604800,description:'1 Week'},{value:'1mo',label:'1M',seconds:2629746,description:'1 Month'}];// Period options optimized for each timeframe\nconst getPeriodOptions=useCallback(currentTimeframe=>{const tf=timeframes.find(t=>t.value===currentTimeframe);if(!tf)return[{value:'1d',label:'1D'}];if(tf.seconds<=300){// 5 minutes or less\nreturn[{value:'1d',label:'1D',bars:288},{value:'3d',label:'3D',bars:864},{value:'1wk',label:'1W',bars:2016},{value:'1mo',label:'1M',bars:8640}];}else if(tf.seconds<=3600){// 1 hour or less\nreturn[{value:'1d',label:'1D',bars:48},{value:'1wk',label:'1W',bars:336},{value:'1mo',label:'1M',bars:1440},{value:'3mo',label:'3M',bars:4320},{value:'1y',label:'1Y',bars:17520}];}else if(tf.seconds<=86400){// 1 day or less\nreturn[{value:'1mo',label:'1M',bars:30},{value:'3mo',label:'3M',bars:90},{value:'6mo',label:'6M',bars:180},{value:'1y',label:'1Y',bars:365},{value:'2y',label:'2Y',bars:730},{value:'5y',label:'5Y',bars:1825}];}else{return[{value:'1y',label:'1Y',bars:52},{value:'2y',label:'2Y',bars:104},{value:'5y',label:'5Y',bars:260},{value:'10y',label:'10Y',bars:520},{value:'max',label:'MAX',bars:1000}];}},[timeframes]);const[indicators,setIndicators]=useState({sma20:{enabled:true,visible:true,color:'#f59e0b',period:20},sma50:{enabled:true,visible:true,color:'#8b5cf6',period:50},ema12:{enabled:false,visible:true,color:'#06b6d4',period:12},ema26:{enabled:false,visible:true,color:'#f97316',period:26},volume:{enabled:true,visible:true,color:'#6b7280'}});// Initialize chart\nuseEffect(()=>{if(!chartContainerRef.current)return;const chart=createChart(chartContainerRef.current,{layout:{background:{type:ColorType.Solid,color:'#0a0a0b'},textColor:'#f9fafb',fontSize:12,fontFamily:'Trebuchet MS'},grid:{vertLines:{color:'rgba(55, 65, 81, 0.5)',style:LineStyle.Dotted},horzLines:{color:'rgba(55, 65, 81, 0.5)',style:LineStyle.Dotted}},crosshair:{mode:CrosshairMode.Normal,vertLine:{color:'#14b8a6',width:1,style:LineStyle.Dashed,labelBackgroundColor:'#14b8a6'},horzLine:{color:'#14b8a6',width:1,style:LineStyle.Dashed,labelBackgroundColor:'#14b8a6'}},rightPriceScale:{borderColor:'#374151',textColor:'#9ca3af',entireTextOnly:true,scaleMargins:{top:0.1,bottom:0.25}},leftPriceScale:{visible:false},timeScale:{borderColor:'#374151',textColor:'#9ca3af',timeVisible:true,secondsVisible:false,rightOffset:12,barSpacing:6,minBarSpacing:3,fixLeftEdge:false,fixRightEdge:false,lockVisibleTimeRangeOnResize:true,tickMarkFormatter:time=>{const date=new Date(time*1000);const tf=timeframes.find(t=>t.value===timeframe);if((tf===null||tf===void 0?void 0:tf.seconds)<3600){// Less than 1 hour\nreturn date.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:false});}else if((tf===null||tf===void 0?void 0:tf.seconds)<86400){// Less than 1 day\nreturn date.toLocaleDateString('en-US',{month:'short',day:'numeric',hour:'2-digit'});}else{return date.toLocaleDateString('en-US',{month:'short',day:'numeric'});}}},width:chartContainerRef.current.clientWidth,height:height,handleScroll:{mouseWheel:true,pressedMouseMove:true,horzTouchDrag:true,vertTouchDrag:true},handleScale:{axisPressedMouseMove:true,mouseWheel:true,pinch:true}});chartRef.current=chart;// Main price series\nlet mainSeries;if(chartType==='candlestick'){mainSeries=chart.addCandlestickSeries({upColor:'#26a69a',downColor:'#ef5350',borderVisible:false,wickUpColor:'#26a69a',wickDownColor:'#ef5350',priceFormat:{type:'price',precision:2,minMove:0.01}});}else if(chartType==='line'){mainSeries=chart.addLineSeries({color:'#14b8a6',lineWidth:2,crosshairMarkerVisible:true,crosshairMarkerRadius:6,crosshairMarkerBorderColor:'#14b8a6',crosshairMarkerBackgroundColor:'#14b8a6'});}else if(chartType==='area'){mainSeries=chart.addAreaSeries({topColor:'rgba(20, 184, 166, 0.4)',bottomColor:'rgba(20, 184, 166, 0.0)',lineColor:'#14b8a6',lineWidth:2,crosshairMarkerVisible:true});}candlestickSeriesRef.current=mainSeries;// Volume series\nif(indicators.volume.enabled){const volumeSeries=chart.addHistogramSeries({color:'rgba(107, 114, 128, 0.8)',priceFormat:{type:'volume'},priceScaleId:'volume'});volumeSeriesRef.current=volumeSeries;chart.priceScale('volume').applyOptions({scaleMargins:{top:0.8,bottom:0},mode:PriceScaleMode.Percentage});}// Handle resize\nconst handleResize=()=>{if(chartContainerRef.current){chart.applyOptions({width:chartContainerRef.current.clientWidth});}};window.addEventListener('resize',handleResize);return()=>{window.removeEventListener('resize',handleResize);Object.values(indicatorSeriesRefs.current).forEach(series=>{if(series&&chart){try{chart.removeSeries(series);}catch(e){// Series may already be removed\n}}});indicatorSeriesRefs.current={};if(chart){chart.remove();}};},[height,chartType,timeframe]);// Clean up on symbol change\nuseEffect(()=>{console.log(`ðŸ”„ Symbol changed to ${symbol}, resetting chart state`);// Reset all state\nsetChartData([]);setCurrentPrice(null);setPriceChange(0);setTradeSignals([]);setLimitOrders([]);setLastUpdateTime(0);setUpdateCount(0);setDataSource('live');// Clear chart data\nif(candlestickSeriesRef.current){try{candlestickSeriesRef.current.setData([]);}catch(e){console.warn('Failed to clear candlestick data:',e);}}if(volumeSeriesRef.current){try{volumeSeriesRef.current.setData([]);}catch(e){console.warn('Failed to clear volume data:',e);}}// Clear indicators\nObject.values(indicatorSeriesRefs.current).forEach(series=>{try{if(series&&typeof series.setData==='function'){series.setData([]);}}catch(e){console.warn('Failed to clear indicator data:',e);}});},[symbol]);// Enhanced data fetching with proper interval handling\nconst fetchMarketData=useCallback(async function(){let forceRefresh=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!symbol||!timeframe)return;setIsLoading(true);try{var _periodOptions$;console.log(`ðŸ“Š Fetching data for ${symbol} at ${timeframe} interval`);// Calculate optimal period based on timeframe\nconst tf=timeframes.find(t=>t.value===timeframe);const periodOptions=getPeriodOptions(timeframe);const currentPeriod=selectedPeriod||((_periodOptions$=periodOptions[0])===null||_periodOptions$===void 0?void 0:_periodOptions$.value)||'1d';// Make API request with explicit interval\nconst params=new URLSearchParams({symbol:symbol,period:currentPeriod,interval:timeframe,// Use exact timeframe from frontend\nmax_points:'2000',force_refresh:forceRefresh.toString()});const response=await fetch(`${apiBaseUrl}/api/market/historical?${params}`);if(!response.ok){throw new Error(`API request failed: ${response.status}`);}const data=await response.json();if(!(data!==null&&data!==void 0&&data.data)||!Array.isArray(data.data)){throw new Error('Invalid data format received');}// Process and validate the data\nconst ohlcData=data.data.map(item=>({time:Math.floor(new Date(item.date).getTime()/1000),open:parseFloat(item.open),high:parseFloat(item.high),low:parseFloat(item.low),close:parseFloat(item.close),volume:parseFloat(item.volume||0)})).filter(item=>!isNaN(item.time)&&!isNaN(item.open)&&!isNaN(item.high)&&!isNaN(item.low)&&!isNaN(item.close)&&item.high>=item.low&&item.high>=Math.max(item.open,item.close)&&item.low<=Math.min(item.open,item.close)).sort((a,b)=>a.time-b.time);if(ohlcData.length===0){throw new Error('No valid data points received');}console.log(`âœ… Loaded ${ohlcData.length} data points for ${symbol} ${timeframe}`);// Update chart data\nsetChartData(ohlcData);setCurrentPrice(ohlcData[ohlcData.length-1].close);setLastUpdateTime(ohlcData[ohlcData.length-1].time);setDataSource(data.source||'live');// Update chart series\nupdateChartSeries(ohlcData);// Auto-size chart for new data\nautoSizeChart('data_load');// Notify parent component\nif(onChartDataUpdate){onChartDataUpdate(ohlcData);}}catch(error){console.error('Failed to fetch market data:',error);setDataSource('error');}finally{setIsLoading(false);}},[symbol,timeframe,selectedPeriod,apiBaseUrl,getPeriodOptions]);// Get optimal visible bars for timeframe\nconst getOptimalVisibleBars=useCallback(timeframe=>{const tf=timeframes.find(t=>t.value===timeframe);if(!tf)return 100;if(tf.seconds<=300)return 100;// 5min: ~8 hours\nif(tf.seconds<=900)return 120;// 15min: ~30 hours  \nif(tf.seconds<=3600)return 100;// 1h: ~4 days\nif(tf.seconds<=14400)return 90;// 4h: ~15 days\nif(tf.seconds<=86400)return 60;// 1d: ~2 months\nreturn 50;// Weekly/Monthly: reasonable view\n},[timeframes]);// Auto-size chart with optimal zoom for current timeframe\nconst autoSizeChart=useCallback(function(){let reason=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'manual';if(!chartRef.current||!chartData.length)return;setTimeout(()=>{try{// First fit all content to establish proper scale\nchartRef.current.timeScale().fitContent();// Then set optimal zoom for current timeframe\nconst visibleBars=getOptimalVisibleBars(timeframe);chartRef.current.timeScale().setVisibleLogicalRange({from:Math.max(0,chartData.length-visibleBars),to:chartData.length+5});console.log(`ðŸ“ Auto-sized chart (${reason}) showing ${visibleBars} bars for ${timeframe}`);}catch(e){console.warn(`Failed to auto-size chart (${reason}):`,e);}},reason==='data_load'?300:100);// Longer wait for data loads\n},[chartRef,chartData,timeframe,getOptimalVisibleBars]);// Update chart series\nconst updateChartSeries=useCallback(ohlcData=>{if(!candlestickSeriesRef.current||!ohlcData.length)return;try{// Update main series\nif(chartType==='candlestick'){candlestickSeriesRef.current.setData(ohlcData);}else if(chartType==='line'){const lineData=ohlcData.map(item=>({time:item.time,value:item.close}));candlestickSeriesRef.current.setData(lineData);}else if(chartType==='area'){const areaData=ohlcData.map(item=>({time:item.time,value:item.close}));candlestickSeriesRef.current.setData(areaData);}// Update volume\nif(indicators.volume.enabled&&volumeSeriesRef.current){const volumeData=ohlcData.map(item=>({time:item.time,value:item.volume,color:chartType==='candlestick'?item.close>=item.open?'rgba(38, 166, 154, 0.8)':'rgba(239, 83, 80, 0.8)':'rgba(107, 114, 128, 0.8)'}));volumeSeriesRef.current.setData(volumeData);}// Update indicators\nupdateIndicators(ohlcData);}catch(error){console.error('Failed to update chart series:',error);}},[chartType,indicators.volume.enabled]);// Enhanced WebSocket connection with 5-second updates\nuseEffect(()=>{if(!isPlaying||!symbol)return;let ws;let reconnectTimeout;let priceUpdateInterval;const connectWebSocket=()=>{try{const wsBaseUrl=process.env.REACT_APP_WS_BASE_URL||'ws://localhost:8000';const wsUrl=`${wsBaseUrl}/api/ws/market/${encodeURIComponent(symbol)}`;console.log(`ðŸ”— Connecting WebSocket for ${symbol}...`);ws=new WebSocket(wsUrl);ws.onopen=()=>{console.log(`âœ… WebSocket connected for ${symbol}`);setConnectionStatus('connected');// Send subscription message with timeframe\nws.send(JSON.stringify({type:'subscribe',symbol:symbol,timeframe:timeframe,interval:5000// 5-second updates\n}));};ws.onmessage=event=>{const data=JSON.parse(event.data);if(data.symbol!==symbol){console.log(`âŒ Ignoring data for ${data.symbol}, current: ${symbol}`);return;}if(data.type==='price_update'){handleRealTimeUpdate(data);}else if(data.type==='historical_data'){handleHistoricalData(data);}else if(data.type==='trading_signal'){handleTradingSignal(data);}};ws.onerror=error=>{console.error('WebSocket error:',error);setConnectionStatus('error');};ws.onclose=()=>{console.log(`ðŸ”Œ WebSocket disconnected for ${symbol}`);setConnectionStatus('disconnected');reconnectTimeout=setTimeout(connectWebSocket,3000);};}catch(error){console.error('Failed to connect WebSocket:',error);setConnectionStatus('error');// Fallback to HTTP polling with 5-second intervals\nstartPollingFallback();}};// HTTP polling fallback with 5-second updates\nconst startPollingFallback=()=>{console.log(`ðŸ”„ Starting 5-second polling for ${symbol}`);setConnectionStatus('polling');priceUpdateInterval=setInterval(async()=>{try{const response=await fetch(`${apiBaseUrl}/api/market/price?symbol=${symbol}`);if(response.ok){const priceData=await response.json();handleRealTimeUpdate({type:'price_update',symbol:priceData.symbol,close:priceData.current_price,volume:priceData.volume,timestamp:Date.now(),source:'polling'});}}catch(error){console.error('Polling error:',error);}},5000);// 5-second intervals\n};// Start connection\nconnectWebSocket();// Also start the primary data fetch\nfetchMarketData();return()=>{if(ws){ws.close();}if(reconnectTimeout){clearTimeout(reconnectTimeout);}if(priceUpdateInterval){clearInterval(priceUpdateInterval);}};},[symbol,timeframe,selectedPeriod,isPlaying,apiBaseUrl,fetchMarketData]);// Handle real-time price updates\nconst handleRealTimeUpdate=useCallback(data=>{if(!data.close||data.symbol!==symbol)return;const price=parseFloat(data.close);if(isNaN(price)||price<=0)return;console.log(`ðŸ’° Real-time update: ${symbol} = $${price.toFixed(2)}`);setCurrentPrice(price);setUpdateCount(prev=>prev+1);setLastUpdateTime(Math.floor(Date.now()/1000));// Update the current candle if we have chart data\nif(chartData.length>0&&candlestickSeriesRef.current){const lastCandle=chartData[chartData.length-1];const now=Math.floor(Date.now()/1000);const tf=timeframes.find(t=>t.value===timeframe);const intervalSeconds=(tf===null||tf===void 0?void 0:tf.seconds)||300;// Check if we need a new candle\nconst candleStartTime=Math.floor(now/intervalSeconds)*intervalSeconds;if(candleStartTime>lastCandle.time){// Create new candle\nconst newCandle={time:candleStartTime,open:price,high:price,low:price,close:price,volume:parseFloat(data.volume||0)};try{if(chartType==='candlestick'){candlestickSeriesRef.current.update(newCandle);}else if(chartType==='line'||chartType==='area'){candlestickSeriesRef.current.update({time:candleStartTime,value:price});}console.log(`ðŸ†• New candle created at ${new Date(candleStartTime*1000).toISOString()}`);}catch(error){console.error('Failed to create new candle:',error);}}else{// Update existing candle\nconst updatedCandle={time:lastCandle.time,open:lastCandle.open,high:Math.max(lastCandle.high,price),low:Math.min(lastCandle.low,price),close:price,volume:Math.max(lastCandle.volume,parseFloat(data.volume||0))};try{if(chartType==='candlestick'){candlestickSeriesRef.current.update(updatedCandle);}else if(chartType==='line'||chartType==='area'){candlestickSeriesRef.current.update({time:lastCandle.time,value:price});}}catch(error){console.error('Failed to update candle:',error);}}}},[symbol,chartData,timeframe,chartType,timeframes]);// Handle historical data from WebSocket\nconst handleHistoricalData=useCallback(data=>{var _data$data;if((_data$data=data.data)!==null&&_data$data!==void 0&&_data$data.data){const ohlcData=data.data.data.map(item=>({time:Math.floor(new Date(item.date).getTime()/1000),open:parseFloat(item.open),high:parseFloat(item.high),low:parseFloat(item.low),close:parseFloat(item.close),volume:parseFloat(item.volume||0)})).sort((a,b)=>a.time-b.time);if(ohlcData.length>0){setChartData(ohlcData);updateChartSeries(ohlcData);setCurrentPrice(ohlcData[ohlcData.length-1].close);// Auto-size chart for WebSocket historical data\nautoSizeChart('websocket_data');}}},[updateChartSeries,autoSizeChart]);// Handle trading signals\nconst handleTradingSignal=useCallback(data=>{if(data.signal){addTradeSignal(data.signal);if(onSignalReceived){onSignalReceived(data.signal);}}},[onSignalReceived]);// Add trade signal marker\nconst addTradeSignal=useCallback(signal=>{if(!candlestickSeriesRef.current)return;const marker={time:signal.time||Math.floor(Date.now()/1000),position:signal.type==='buy'?'belowBar':'aboveBar',color:signal.type==='buy'?'#26a69a':'#ef5350',shape:signal.type==='buy'?'arrowUp':'arrowDown',text:`${signal.type.toUpperCase()}${signal.price?`: $${signal.price}`:''}`,size:signal.strength||1};setTradeSignals(prev=>{const newSignals=[...prev,marker];candlestickSeriesRef.current.setMarkers(newSignals);return newSignals;});},[]);// Update indicators\nconst updateIndicators=useCallback(ohlcData=>{if(!chartRef.current||!ohlcData.length)return;// Clear existing indicators\nObject.keys(indicatorSeriesRefs.current).forEach(key=>{const series=indicatorSeriesRefs.current[key];if(series){try{chartRef.current.removeSeries(series);}catch(e){// Series may already be removed\n}}});indicatorSeriesRefs.current={};// Add enabled indicators\nObject.entries(indicators).forEach(_ref2=>{let[key,config]=_ref2;if(!config.enabled||!config.visible||key==='volume')return;try{if(key==='sma20'||key==='sma50'){const period=config.period;const smaData=calculateSMA(ohlcData,period);if(smaData.length>0){const series=chartRef.current.addLineSeries({color:config.color,lineWidth:2,title:`SMA ${period}`,lastValueVisible:true,priceLineVisible:false});series.setData(smaData);indicatorSeriesRefs.current[key]=series;}}else if(key==='ema12'||key==='ema26'){const period=config.period;const emaData=calculateEMA(ohlcData,period);if(emaData.length>0){const series=chartRef.current.addLineSeries({color:config.color,lineWidth:2,title:`EMA ${period}`,lastValueVisible:true,priceLineVisible:false});series.setData(emaData);indicatorSeriesRefs.current[key]=series;}}}catch(error){console.error(`Error adding indicator ${key}:`,error);}});},[indicators]);// Technical analysis functions\nconst calculateSMA=(data,period)=>{const result=[];for(let i=period-1;i<data.length;i++){let sum=0;for(let j=0;j<period;j++){sum+=data[i-j].close;}result.push({time:data[i].time,value:parseFloat((sum/period).toFixed(2))});}return result;};const calculateEMA=(data,period)=>{var _data$;const result=[];const multiplier=2/(period+1);let ema=((_data$=data[0])===null||_data$===void 0?void 0:_data$.close)||0;for(let i=0;i<data.length;i++){if(i===0){ema=data[i].close;}else{ema=data[i].close*multiplier+ema*(1-multiplier);}result.push({time:data[i].time,value:parseFloat(ema.toFixed(2))});}return result;};// Control functions\nconst changeTimeframe=useCallback(newTimeframe=>{var _periodOptions$2;console.log(`ðŸ“Š Changing timeframe from ${timeframe} to ${newTimeframe}`);setTimeframe(newTimeframe);// Reset period to first available option for new timeframe\nconst periodOptions=getPeriodOptions(newTimeframe);setSelectedPeriod(((_periodOptions$2=periodOptions[0])===null||_periodOptions$2===void 0?void 0:_periodOptions$2.value)||'1d');// Auto-resize chart for new timeframe after data loads\nsetTimeout(()=>autoSizeChart('timeframe_change'),500);},[timeframe,getPeriodOptions,autoSizeChart]);const changeChartType=useCallback(newType=>{console.log(`ðŸ“Š Changing chart type from ${chartType} to ${newType}`);setChartType(newType);// Auto-resize chart for new chart type\nsetTimeout(()=>autoSizeChart('chart_type_change'),200);},[chartType,autoSizeChart]);const changePeriod=useCallback(newPeriod=>{console.log(`ðŸ“Š Changing period from ${selectedPeriod} to ${newPeriod}`);setSelectedPeriod(newPeriod);// Auto-resize chart for new period after data loads\nsetTimeout(()=>autoSizeChart('period_change'),500);},[selectedPeriod,autoSizeChart]);const toggleIndicator=useCallback(indicator=>{setIndicators(prev=>({...prev,[indicator]:{...prev[indicator],enabled:!prev[indicator].enabled}}));},[]);// Get connection status indicator\nconst getConnectionIndicator=()=>{switch(connectionStatus){case'connected':return{color:'bg-green-400',text:'Live WebSocket'};case'polling':return{color:'bg-yellow-400',text:'Live Polling'};case'error':return{color:'bg-red-400',text:'Connection Error'};default:return{color:'bg-gray-400',text:'Disconnected'};}};const connectionInfo=getConnectionIndicator();return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-900 rounded-lg border border-gray-700 flex flex-col h-full\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between p-3 border-b border-gray-700 bg-gray-800 flex-wrap gap-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4 flex-wrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowSymbolSearch(true),className:\"flex items-center space-x-2 px-3 py-1 rounded-md hover:bg-gray-700 transition-colors\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-white\",children:displaySymbol}),/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 text-gray-400\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 9l-7 7-7-7\"})})]})}),currentPrice&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-lg font-mono font-bold text-white\",children:[\"$\",typeof currentPrice==='number'?currentPrice.toFixed(2):currentPrice]}),/*#__PURE__*/_jsxs(\"span\",{className:`text-sm font-medium ${priceChange>0?'text-green-400':priceChange<0?'text-red-400':'text-gray-400'}`,children:[priceChange>0?'+':'',priceChange.toFixed(2),\" (\",(priceChange/currentPrice*100).toFixed(2),\"%)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs text-gray-400\",children:\"Interval:\"}),/*#__PURE__*/_jsx(\"select\",{value:timeframe,onChange:e=>changeTimeframe(e.target.value),className:\"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600 focus:outline-none focus:border-blue-500\",children:timeframes.map(tf=>/*#__PURE__*/_jsxs(\"option\",{value:tf.value,children:[tf.label,\" - \",tf.description]},tf.value))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs text-gray-400\",children:\"Period:\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedPeriod,onChange:e=>changePeriod(e.target.value),className:\"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600 focus:outline-none focus:border-green-500\",children:getPeriodOptions(timeframe).map(period=>/*#__PURE__*/_jsxs(\"option\",{value:period.value,children:[period.label,\" (\",period.bars,\" bars)\"]},period.value))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 flex-wrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-xs\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Source:\"}),/*#__PURE__*/_jsx(\"span\",{className:`px-2 py-1 rounded text-xs ${dataSource==='live'?'bg-green-600 text-white':dataSource==='cached'?'bg-yellow-600 text-white':dataSource==='fallback'?'bg-orange-600 text-white':'bg-red-600 text-white'}`,children:dataSource.toUpperCase()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs text-gray-400\",children:\"Type:\"}),/*#__PURE__*/_jsxs(\"select\",{value:chartType,onChange:e=>changeChartType(e.target.value),className:\"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600 focus:outline-none focus:border-purple-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"candlestick\",children:\"Candlestick\"}),/*#__PURE__*/_jsx(\"option\",{value:\"line\",children:\"Line\"}),/*#__PURE__*/_jsx(\"option\",{value:\"area\",children:\"Area\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsPlaying(!isPlaying),className:\"p-2 rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors\",title:isPlaying?'Pause':'Resume',children:isPlaying?/*#__PURE__*/_jsx(PauseIcon,{className:\"w-4 h-4 text-white\"}):/*#__PURE__*/_jsx(PlayIcon,{className:\"w-4 h-4 text-white\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>fetchMarketData(true),disabled:isLoading,className:\"p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors disabled:opacity-50\",title:\"Refresh Data\",children:/*#__PURE__*/_jsx(\"svg\",{className:`w-4 h-4 text-gray-300 ${isLoading?'animate-spin':''}`,fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"})})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-2 border-b border-gray-700 bg-gray-850\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2 items-center\",children:Object.entries(indicators).map(_ref3=>{let[key,config]=_ref3;return config.enabled&&key!=='volume'&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>toggleIndicator(key),className:`px-2 py-1 text-xs rounded border transition-colors ${config.visible?'bg-blue-600 border-blue-600 text-white':'bg-transparent border-gray-600 text-gray-400 hover:border-blue-500'}`,style:{borderColor:config.visible?config.color:undefined},children:[/*#__PURE__*/_jsx(\"span\",{className:\"inline-block w-2 h-2 rounded-full mr-1\",style:{backgroundColor:config.color}}),key.toUpperCase()]},key);})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 relative\",children:[/*#__PURE__*/_jsx(\"div\",{ref:chartContainerRef,className:\"absolute inset-0\"}),isLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 p-4 rounded-lg flex items-center space-x-3\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin h-5 w-5 text-blue-500\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-white\",children:\"Loading market data...\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 border-t border-gray-700 bg-gray-800\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-xs text-gray-400\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:`w-2 h-2 ${connectionInfo.color} rounded-full mr-1`}),connectionInfo.text]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Interval: \",timeframe]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Updates: \",updateCount]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Bars: \",chartData.length]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Signals: \",tradeSignals.length]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Last: \",new Date().toLocaleTimeString()]})]})]})}),/*#__PURE__*/_jsx(DynamicSymbolSearch,{isOpen:showSymbolSearch,onClose:()=>setShowSymbolSearch(false),onSymbolSelect:(newSymbol,newDisplaySymbol)=>{if(onSymbolChange)onSymbolChange(newSymbol,newDisplaySymbol);},currentSymbol:symbol})]});};export default TradingChartV3;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","createChart","ColorType","CrosshairMode","LineStyle","PriceScaleMode","Cog6ToothIcon","ChartBarIcon","PlayIcon","PauseIcon","MagnifyingGlassIcon","PlusIcon","EyeIcon","EyeSlashIcon","AdjustmentsHorizontalIcon","DynamicSymbolSearch","jsx","_jsx","jsxs","_jsxs","TradingChartV3","_ref","symbol","displaySymbol","height","apiBaseUrl","process","env","REACT_APP_API_BASE_URL","onSignalReceived","onSymbolChange","onChartDataUpdate","chartContainerRef","chartRef","candlestickSeriesRef","volumeSeriesRef","indicatorSeriesRefs","isPlaying","setIsPlaying","showSymbolSearch","setShowSymbolSearch","timeframe","setTimeframe","selectedPeriod","setSelectedPeriod","chartType","setChartType","showDrawingTools","setShowDrawingTools","showIndicatorSearch","setShowIndicatorSearch","indicatorSearchTerm","setIndicatorSearchTerm","chartData","setChartData","currentPrice","setCurrentPrice","priceChange","setPriceChange","tradeSignals","setTradeSignals","limitOrders","setLimitOrders","isLoading","setIsLoading","dataSource","setDataSource","lastUpdateTime","setLastUpdateTime","updateCount","setUpdateCount","connectionStatus","setConnectionStatus","wsRef","reconnectTimeoutRef","updateIntervalRef","timeframes","value","label","seconds","description","getPeriodOptions","currentTimeframe","tf","find","t","bars","indicators","setIndicators","sma20","enabled","visible","color","period","sma50","ema12","ema26","volume","current","chart","layout","background","type","Solid","textColor","fontSize","fontFamily","grid","vertLines","style","Dotted","horzLines","crosshair","mode","Normal","vertLine","width","Dashed","labelBackgroundColor","horzLine","rightPriceScale","borderColor","entireTextOnly","scaleMargins","top","bottom","leftPriceScale","timeScale","timeVisible","secondsVisible","rightOffset","barSpacing","minBarSpacing","fixLeftEdge","fixRightEdge","lockVisibleTimeRangeOnResize","tickMarkFormatter","time","date","Date","toLocaleTimeString","hour","minute","hour12","toLocaleDateString","month","day","clientWidth","handleScroll","mouseWheel","pressedMouseMove","horzTouchDrag","vertTouchDrag","handleScale","axisPressedMouseMove","pinch","mainSeries","addCandlestickSeries","upColor","downColor","borderVisible","wickUpColor","wickDownColor","priceFormat","precision","minMove","addLineSeries","lineWidth","crosshairMarkerVisible","crosshairMarkerRadius","crosshairMarkerBorderColor","crosshairMarkerBackgroundColor","addAreaSeries","topColor","bottomColor","lineColor","volumeSeries","addHistogramSeries","priceScaleId","priceScale","applyOptions","Percentage","handleResize","window","addEventListener","removeEventListener","Object","values","forEach","series","removeSeries","e","remove","console","log","setData","warn","fetchMarketData","forceRefresh","arguments","length","undefined","_periodOptions$","periodOptions","currentPeriod","params","URLSearchParams","interval","max_points","force_refresh","toString","response","fetch","ok","Error","status","data","json","Array","isArray","ohlcData","map","item","Math","floor","getTime","open","parseFloat","high","low","close","filter","isNaN","max","min","sort","a","b","source","updateChartSeries","autoSizeChart","error","getOptimalVisibleBars","reason","setTimeout","fitContent","visibleBars","setVisibleLogicalRange","from","to","lineData","areaData","volumeData","updateIndicators","ws","reconnectTimeout","priceUpdateInterval","connectWebSocket","wsBaseUrl","REACT_APP_WS_BASE_URL","wsUrl","encodeURIComponent","WebSocket","onopen","send","JSON","stringify","onmessage","event","parse","handleRealTimeUpdate","handleHistoricalData","handleTradingSignal","onerror","onclose","startPollingFallback","setInterval","priceData","current_price","timestamp","now","clearTimeout","clearInterval","price","toFixed","prev","lastCandle","intervalSeconds","candleStartTime","newCandle","update","toISOString","updatedCandle","_data$data","signal","addTradeSignal","marker","position","shape","text","toUpperCase","size","strength","newSignals","setMarkers","keys","key","entries","_ref2","config","smaData","calculateSMA","title","lastValueVisible","priceLineVisible","emaData","calculateEMA","result","i","sum","j","push","_data$","multiplier","ema","changeTimeframe","newTimeframe","_periodOptions$2","changeChartType","newType","changePeriod","newPeriod","toggleIndicator","indicator","getConnectionIndicator","connectionInfo","className","children","onClick","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","onChange","target","disabled","_ref3","backgroundColor","ref","cx","cy","r","isOpen","onClose","onSymbolSelect","newSymbol","newDisplaySymbol","currentSymbol"],"sources":["/Users/wilderbaldwin/Dev/tragen/frontend/src/components/TradingChartV3.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { createChart, ColorType, CrosshairMode, LineStyle, PriceScaleMode } from 'lightweight-charts';\nimport {\n  Cog6ToothIcon,\n  ChartBarIcon,\n  PlayIcon,\n  PauseIcon,\n  MagnifyingGlassIcon,\n  PlusIcon,\n  EyeIcon,\n  EyeSlashIcon,\n  AdjustmentsHorizontalIcon,\n} from '@heroicons/react/24/outline';\nimport DynamicSymbolSearch from './DynamicSymbolSearch';\n\nconst TradingChartV3 = ({ \n  symbol = 'NQ=F', \n  displaySymbol = 'NQ', \n  height = 600, \n  apiBaseUrl = process.env.REACT_APP_API_BASE_URL || 'http://localhost:8000', \n  onSignalReceived, \n  onSymbolChange, \n  onChartDataUpdate \n}) => {\n  const chartContainerRef = useRef(null);\n  const chartRef = useRef(null);\n  const candlestickSeriesRef = useRef(null);\n  const volumeSeriesRef = useRef(null);\n  const indicatorSeriesRefs = useRef({});\n  \n  // Chart state\n  const [isPlaying, setIsPlaying] = useState(true);\n  const [showSymbolSearch, setShowSymbolSearch] = useState(false);\n  const [timeframe, setTimeframe] = useState('5m');\n  const [selectedPeriod, setSelectedPeriod] = useState('1d');\n  const [chartType, setChartType] = useState('candlestick');\n  const [showDrawingTools, setShowDrawingTools] = useState(false);\n  const [showIndicatorSearch, setShowIndicatorSearch] = useState(false);\n  const [indicatorSearchTerm, setIndicatorSearchTerm] = useState('');\n  \n  // Data state\n  const [chartData, setChartData] = useState([]);\n  const [currentPrice, setCurrentPrice] = useState(null);\n  const [priceChange, setPriceChange] = useState(0);\n  const [tradeSignals, setTradeSignals] = useState([]);\n  const [limitOrders, setLimitOrders] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [dataSource, setDataSource] = useState('live'); // 'live', 'cached', 'fallback'\n  \n  // Real-time update state\n  const [lastUpdateTime, setLastUpdateTime] = useState(0);\n  const [updateCount, setUpdateCount] = useState(0);\n  const [connectionStatus, setConnectionStatus] = useState('disconnected');\n  \n  // WebSocket refs\n  const wsRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const updateIntervalRef = useRef(null);\n\n  // Professional timeframe configuration with proper intervals\n  const timeframes = [\n    { value: '1m', label: '1m', seconds: 60, description: '1 Minute' },\n    { value: '3m', label: '3m', seconds: 180, description: '3 Minutes' },\n    { value: '5m', label: '5m', seconds: 300, description: '5 Minutes' },\n    { value: '15m', label: '15m', seconds: 900, description: '15 Minutes' },\n    { value: '30m', label: '30m', seconds: 1800, description: '30 Minutes' },\n    { value: '1h', label: '1h', seconds: 3600, description: '1 Hour' },\n    { value: '2h', label: '2h', seconds: 7200, description: '2 Hours' },\n    { value: '4h', label: '4h', seconds: 14400, description: '4 Hours' },\n    { value: '6h', label: '6h', seconds: 21600, description: '6 Hours' },\n    { value: '12h', label: '12h', seconds: 43200, description: '12 Hours' },\n    { value: '1d', label: '1D', seconds: 86400, description: '1 Day' },\n    { value: '1wk', label: '1W', seconds: 604800, description: '1 Week' },\n    { value: '1mo', label: '1M', seconds: 2629746, description: '1 Month' },\n  ];\n\n  // Period options optimized for each timeframe\n  const getPeriodOptions = useCallback((currentTimeframe) => {\n    const tf = timeframes.find(t => t.value === currentTimeframe);\n    if (!tf) return [{ value: '1d', label: '1D' }];\n    \n    if (tf.seconds <= 300) { // 5 minutes or less\n      return [\n        { value: '1d', label: '1D', bars: 288 },\n        { value: '3d', label: '3D', bars: 864 },\n        { value: '1wk', label: '1W', bars: 2016 },\n        { value: '1mo', label: '1M', bars: 8640 },\n      ];\n    } else if (tf.seconds <= 3600) { // 1 hour or less\n      return [\n        { value: '1d', label: '1D', bars: 48 },\n        { value: '1wk', label: '1W', bars: 336 },\n        { value: '1mo', label: '1M', bars: 1440 },\n        { value: '3mo', label: '3M', bars: 4320 },\n        { value: '1y', label: '1Y', bars: 17520 },\n      ];\n    } else if (tf.seconds <= 86400) { // 1 day or less\n      return [\n        { value: '1mo', label: '1M', bars: 30 },\n        { value: '3mo', label: '3M', bars: 90 },\n        { value: '6mo', label: '6M', bars: 180 },\n        { value: '1y', label: '1Y', bars: 365 },\n        { value: '2y', label: '2Y', bars: 730 },\n        { value: '5y', label: '5Y', bars: 1825 },\n      ];\n    } else {\n      return [\n        { value: '1y', label: '1Y', bars: 52 },\n        { value: '2y', label: '2Y', bars: 104 },\n        { value: '5y', label: '5Y', bars: 260 },\n        { value: '10y', label: '10Y', bars: 520 },\n        { value: 'max', label: 'MAX', bars: 1000 },\n      ];\n    }\n  }, [timeframes]);\n\n  const [indicators, setIndicators] = useState({\n    sma20: { enabled: true, visible: true, color: '#f59e0b', period: 20 },\n    sma50: { enabled: true, visible: true, color: '#8b5cf6', period: 50 },\n    ema12: { enabled: false, visible: true, color: '#06b6d4', period: 12 },\n    ema26: { enabled: false, visible: true, color: '#f97316', period: 26 },\n    volume: { enabled: true, visible: true, color: '#6b7280' },\n  });\n\n  // Initialize chart\n  useEffect(() => {\n    if (!chartContainerRef.current) return;\n\n    const chart = createChart(chartContainerRef.current, {\n      layout: {\n        background: { type: ColorType.Solid, color: '#0a0a0b' },\n        textColor: '#f9fafb',\n        fontSize: 12,\n        fontFamily: 'Trebuchet MS',\n      },\n      grid: {\n        vertLines: { color: 'rgba(55, 65, 81, 0.5)', style: LineStyle.Dotted },\n        horzLines: { color: 'rgba(55, 65, 81, 0.5)', style: LineStyle.Dotted },\n      },\n      crosshair: {\n        mode: CrosshairMode.Normal,\n        vertLine: {\n          color: '#14b8a6',\n          width: 1,\n          style: LineStyle.Dashed,\n          labelBackgroundColor: '#14b8a6',\n        },\n        horzLine: {\n          color: '#14b8a6',\n          width: 1,\n          style: LineStyle.Dashed,\n          labelBackgroundColor: '#14b8a6',\n        },\n      },\n      rightPriceScale: {\n        borderColor: '#374151',\n        textColor: '#9ca3af',\n        entireTextOnly: true,\n        scaleMargins: { top: 0.1, bottom: 0.25 },\n      },\n      leftPriceScale: { visible: false },\n      timeScale: {\n        borderColor: '#374151',\n        textColor: '#9ca3af',\n        timeVisible: true,\n        secondsVisible: false,\n        rightOffset: 12,\n        barSpacing: 6,\n        minBarSpacing: 3,\n        fixLeftEdge: false,\n        fixRightEdge: false,\n        lockVisibleTimeRangeOnResize: true,\n        tickMarkFormatter: (time) => {\n          const date = new Date(time * 1000);\n          const tf = timeframes.find(t => t.value === timeframe);\n          \n          if (tf?.seconds < 3600) { // Less than 1 hour\n            return date.toLocaleTimeString('en-US', { \n              hour: '2-digit', \n              minute: '2-digit',\n              hour12: false \n            });\n          } else if (tf?.seconds < 86400) { // Less than 1 day\n            return date.toLocaleDateString('en-US', { \n              month: 'short', \n              day: 'numeric',\n              hour: '2-digit'\n            });\n          } else {\n            return date.toLocaleDateString('en-US', { \n              month: 'short', \n              day: 'numeric'\n            });\n          }\n        },\n      },\n      width: chartContainerRef.current.clientWidth,\n      height: height,\n      handleScroll: {\n        mouseWheel: true,\n        pressedMouseMove: true,\n        horzTouchDrag: true,\n        vertTouchDrag: true,\n      },\n      handleScale: {\n        axisPressedMouseMove: true,\n        mouseWheel: true,\n        pinch: true,\n      },\n    });\n\n    chartRef.current = chart;\n\n    // Main price series\n    let mainSeries;\n    if (chartType === 'candlestick') {\n      mainSeries = chart.addCandlestickSeries({\n        upColor: '#26a69a',\n        downColor: '#ef5350',\n        borderVisible: false,\n        wickUpColor: '#26a69a',\n        wickDownColor: '#ef5350',\n        priceFormat: {\n          type: 'price',\n          precision: 2,\n          minMove: 0.01,\n        },\n      });\n    } else if (chartType === 'line') {\n      mainSeries = chart.addLineSeries({\n        color: '#14b8a6',\n        lineWidth: 2,\n        crosshairMarkerVisible: true,\n        crosshairMarkerRadius: 6,\n        crosshairMarkerBorderColor: '#14b8a6',\n        crosshairMarkerBackgroundColor: '#14b8a6',\n      });\n    } else if (chartType === 'area') {\n      mainSeries = chart.addAreaSeries({\n        topColor: 'rgba(20, 184, 166, 0.4)',\n        bottomColor: 'rgba(20, 184, 166, 0.0)',\n        lineColor: '#14b8a6',\n        lineWidth: 2,\n        crosshairMarkerVisible: true,\n      });\n    }\n\n    candlestickSeriesRef.current = mainSeries;\n\n    // Volume series\n    if (indicators.volume.enabled) {\n      const volumeSeries = chart.addHistogramSeries({\n        color: 'rgba(107, 114, 128, 0.8)',\n        priceFormat: { type: 'volume' },\n        priceScaleId: 'volume',\n      });\n      volumeSeriesRef.current = volumeSeries;\n\n      chart.priceScale('volume').applyOptions({\n        scaleMargins: { top: 0.8, bottom: 0 },\n        mode: PriceScaleMode.Percentage,\n      });\n    }\n\n    // Handle resize\n    const handleResize = () => {\n      if (chartContainerRef.current) {\n        chart.applyOptions({\n          width: chartContainerRef.current.clientWidth,\n        });\n      }\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n      Object.values(indicatorSeriesRefs.current).forEach(series => {\n        if (series && chart) {\n          try {\n            chart.removeSeries(series);\n          } catch (e) {\n            // Series may already be removed\n          }\n        }\n      });\n      indicatorSeriesRefs.current = {};\n      if (chart) {\n        chart.remove();\n      }\n    };\n  }, [height, chartType, timeframe]);\n\n  // Clean up on symbol change\n  useEffect(() => {\n    console.log(`ðŸ”„ Symbol changed to ${symbol}, resetting chart state`);\n    \n    // Reset all state\n    setChartData([]);\n    setCurrentPrice(null);\n    setPriceChange(0);\n    setTradeSignals([]);\n    setLimitOrders([]);\n    setLastUpdateTime(0);\n    setUpdateCount(0);\n    setDataSource('live');\n    \n    // Clear chart data\n    if (candlestickSeriesRef.current) {\n      try {\n        candlestickSeriesRef.current.setData([]);\n      } catch (e) {\n        console.warn('Failed to clear candlestick data:', e);\n      }\n    }\n    \n    if (volumeSeriesRef.current) {\n      try {\n        volumeSeriesRef.current.setData([]);\n      } catch (e) {\n        console.warn('Failed to clear volume data:', e);\n      }\n    }\n\n    // Clear indicators\n    Object.values(indicatorSeriesRefs.current).forEach(series => {\n      try {\n        if (series && typeof series.setData === 'function') {\n          series.setData([]);\n        }\n      } catch (e) {\n        console.warn('Failed to clear indicator data:', e);\n      }\n    });\n    \n  }, [symbol]);\n\n  // Enhanced data fetching with proper interval handling\n  const fetchMarketData = useCallback(async (forceRefresh = false) => {\n    if (!symbol || !timeframe) return;\n    \n    setIsLoading(true);\n    \n    try {\n      console.log(`ðŸ“Š Fetching data for ${symbol} at ${timeframe} interval`);\n      \n      // Calculate optimal period based on timeframe\n      const tf = timeframes.find(t => t.value === timeframe);\n      const periodOptions = getPeriodOptions(timeframe);\n      const currentPeriod = selectedPeriod || periodOptions[0]?.value || '1d';\n      \n      // Make API request with explicit interval\n      const params = new URLSearchParams({\n        symbol: symbol,\n        period: currentPeriod,\n        interval: timeframe, // Use exact timeframe from frontend\n        max_points: '2000',\n        force_refresh: forceRefresh.toString()\n      });\n      \n      const response = await fetch(`${apiBaseUrl}/api/market/historical?${params}`);\n      \n      if (!response.ok) {\n        throw new Error(`API request failed: ${response.status}`);\n      }\n      \n      const data = await response.json();\n      \n      if (!data?.data || !Array.isArray(data.data)) {\n        throw new Error('Invalid data format received');\n      }\n\n      // Process and validate the data\n      const ohlcData = data.data\n        .map(item => ({\n          time: Math.floor(new Date(item.date).getTime() / 1000),\n          open: parseFloat(item.open),\n          high: parseFloat(item.high),\n          low: parseFloat(item.low),\n          close: parseFloat(item.close),\n          volume: parseFloat(item.volume || 0)\n        }))\n        .filter(item => \n          !isNaN(item.time) && \n          !isNaN(item.open) && \n          !isNaN(item.high) && \n          !isNaN(item.low) && \n          !isNaN(item.close) &&\n          item.high >= item.low &&\n          item.high >= Math.max(item.open, item.close) &&\n          item.low <= Math.min(item.open, item.close)\n        )\n        .sort((a, b) => a.time - b.time);\n\n      if (ohlcData.length === 0) {\n        throw new Error('No valid data points received');\n      }\n\n      console.log(`âœ… Loaded ${ohlcData.length} data points for ${symbol} ${timeframe}`);\n      \n      // Update chart data\n      setChartData(ohlcData);\n      setCurrentPrice(ohlcData[ohlcData.length - 1].close);\n      setLastUpdateTime(ohlcData[ohlcData.length - 1].time);\n      setDataSource(data.source || 'live');\n      \n      // Update chart series\n      updateChartSeries(ohlcData);\n      \n      // Auto-size chart for new data\n      autoSizeChart('data_load');\n      \n      // Notify parent component\n      if (onChartDataUpdate) {\n        onChartDataUpdate(ohlcData);\n      }\n      \n    } catch (error) {\n      console.error('Failed to fetch market data:', error);\n      setDataSource('error');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [symbol, timeframe, selectedPeriod, apiBaseUrl, getPeriodOptions]);\n\n  // Get optimal visible bars for timeframe\n  const getOptimalVisibleBars = useCallback((timeframe) => {\n    const tf = timeframes.find(t => t.value === timeframe);\n    if (!tf) return 100;\n    \n    if (tf.seconds <= 300) return 100; // 5min: ~8 hours\n    if (tf.seconds <= 900) return 120; // 15min: ~30 hours  \n    if (tf.seconds <= 3600) return 100; // 1h: ~4 days\n    if (tf.seconds <= 14400) return 90; // 4h: ~15 days\n    if (tf.seconds <= 86400) return 60; // 1d: ~2 months\n    return 50; // Weekly/Monthly: reasonable view\n  }, [timeframes]);\n\n  // Auto-size chart with optimal zoom for current timeframe\n  const autoSizeChart = useCallback((reason = 'manual') => {\n    if (!chartRef.current || !chartData.length) return;\n    \n    setTimeout(() => {\n      try {\n        // First fit all content to establish proper scale\n        chartRef.current.timeScale().fitContent();\n        \n        // Then set optimal zoom for current timeframe\n        const visibleBars = getOptimalVisibleBars(timeframe);\n        chartRef.current.timeScale().setVisibleLogicalRange({\n          from: Math.max(0, chartData.length - visibleBars),\n          to: chartData.length + 5\n        });\n        \n        console.log(`ðŸ“ Auto-sized chart (${reason}) showing ${visibleBars} bars for ${timeframe}`);\n      } catch (e) {\n        console.warn(`Failed to auto-size chart (${reason}):`, e);\n      }\n    }, reason === 'data_load' ? 300 : 100); // Longer wait for data loads\n  }, [chartRef, chartData, timeframe, getOptimalVisibleBars]);\n\n  // Update chart series\n  const updateChartSeries = useCallback((ohlcData) => {\n    if (!candlestickSeriesRef.current || !ohlcData.length) return;\n\n    try {\n      // Update main series\n      if (chartType === 'candlestick') {\n        candlestickSeriesRef.current.setData(ohlcData);\n      } else if (chartType === 'line') {\n        const lineData = ohlcData.map(item => ({\n          time: item.time,\n          value: item.close,\n        }));\n        candlestickSeriesRef.current.setData(lineData);\n      } else if (chartType === 'area') {\n        const areaData = ohlcData.map(item => ({\n          time: item.time,\n          value: item.close,\n        }));\n        candlestickSeriesRef.current.setData(areaData);\n      }\n\n      // Update volume\n      if (indicators.volume.enabled && volumeSeriesRef.current) {\n        const volumeData = ohlcData.map(item => ({\n          time: item.time,\n          value: item.volume,\n          color: chartType === 'candlestick' ? \n            (item.close >= item.open ? 'rgba(38, 166, 154, 0.8)' : 'rgba(239, 83, 80, 0.8)') :\n            'rgba(107, 114, 128, 0.8)',\n        }));\n        volumeSeriesRef.current.setData(volumeData);\n      }\n\n      // Update indicators\n      updateIndicators(ohlcData);\n      \n    } catch (error) {\n      console.error('Failed to update chart series:', error);\n    }\n  }, [chartType, indicators.volume.enabled]);\n\n  // Enhanced WebSocket connection with 5-second updates\n  useEffect(() => {\n    if (!isPlaying || !symbol) return;\n\n    let ws;\n    let reconnectTimeout;\n    let priceUpdateInterval;\n\n    const connectWebSocket = () => {\n      try {\n        const wsBaseUrl = process.env.REACT_APP_WS_BASE_URL || 'ws://localhost:8000';\n        const wsUrl = `${wsBaseUrl}/api/ws/market/${encodeURIComponent(symbol)}`;\n        \n        console.log(`ðŸ”— Connecting WebSocket for ${symbol}...`);\n        ws = new WebSocket(wsUrl);\n        \n        ws.onopen = () => {\n          console.log(`âœ… WebSocket connected for ${symbol}`);\n          setConnectionStatus('connected');\n          \n          // Send subscription message with timeframe\n          ws.send(JSON.stringify({\n            type: 'subscribe',\n            symbol: symbol,\n            timeframe: timeframe,\n            interval: 5000 // 5-second updates\n          }));\n        };\n\n        ws.onmessage = (event) => {\n          const data = JSON.parse(event.data);\n          \n          if (data.symbol !== symbol) {\n            console.log(`âŒ Ignoring data for ${data.symbol}, current: ${symbol}`);\n            return;\n          }\n          \n          if (data.type === 'price_update') {\n            handleRealTimeUpdate(data);\n          } else if (data.type === 'historical_data') {\n            handleHistoricalData(data);\n          } else if (data.type === 'trading_signal') {\n            handleTradingSignal(data);\n          }\n        };\n\n        ws.onerror = (error) => {\n          console.error('WebSocket error:', error);\n          setConnectionStatus('error');\n        };\n\n        ws.onclose = () => {\n          console.log(`ðŸ”Œ WebSocket disconnected for ${symbol}`);\n          setConnectionStatus('disconnected');\n          reconnectTimeout = setTimeout(connectWebSocket, 3000);\n        };\n        \n      } catch (error) {\n        console.error('Failed to connect WebSocket:', error);\n        setConnectionStatus('error');\n        \n        // Fallback to HTTP polling with 5-second intervals\n        startPollingFallback();\n      }\n    };\n\n    // HTTP polling fallback with 5-second updates\n    const startPollingFallback = () => {\n      console.log(`ðŸ”„ Starting 5-second polling for ${symbol}`);\n      setConnectionStatus('polling');\n      \n      priceUpdateInterval = setInterval(async () => {\n        try {\n          const response = await fetch(`${apiBaseUrl}/api/market/price?symbol=${symbol}`);\n          if (response.ok) {\n            const priceData = await response.json();\n            handleRealTimeUpdate({\n              type: 'price_update',\n              symbol: priceData.symbol,\n              close: priceData.current_price,\n              volume: priceData.volume,\n              timestamp: Date.now(),\n              source: 'polling'\n            });\n          }\n        } catch (error) {\n          console.error('Polling error:', error);\n        }\n      }, 5000); // 5-second intervals\n    };\n\n    // Start connection\n    connectWebSocket();\n    \n    // Also start the primary data fetch\n    fetchMarketData();\n\n    return () => {\n      if (ws) {\n        ws.close();\n      }\n      if (reconnectTimeout) {\n        clearTimeout(reconnectTimeout);\n      }\n      if (priceUpdateInterval) {\n        clearInterval(priceUpdateInterval);\n      }\n    };\n  }, [symbol, timeframe, selectedPeriod, isPlaying, apiBaseUrl, fetchMarketData]);\n\n  // Handle real-time price updates\n  const handleRealTimeUpdate = useCallback((data) => {\n    if (!data.close || data.symbol !== symbol) return;\n    \n    const price = parseFloat(data.close);\n    if (isNaN(price) || price <= 0) return;\n    \n    console.log(`ðŸ’° Real-time update: ${symbol} = $${price.toFixed(2)}`);\n    \n    setCurrentPrice(price);\n    setUpdateCount(prev => prev + 1);\n    setLastUpdateTime(Math.floor(Date.now() / 1000));\n    \n    // Update the current candle if we have chart data\n    if (chartData.length > 0 && candlestickSeriesRef.current) {\n      const lastCandle = chartData[chartData.length - 1];\n      const now = Math.floor(Date.now() / 1000);\n      const tf = timeframes.find(t => t.value === timeframe);\n      const intervalSeconds = tf?.seconds || 300;\n      \n      // Check if we need a new candle\n      const candleStartTime = Math.floor(now / intervalSeconds) * intervalSeconds;\n      \n      if (candleStartTime > lastCandle.time) {\n        // Create new candle\n        const newCandle = {\n          time: candleStartTime,\n          open: price,\n          high: price,\n          low: price,\n          close: price,\n          volume: parseFloat(data.volume || 0)\n        };\n        \n        try {\n          if (chartType === 'candlestick') {\n            candlestickSeriesRef.current.update(newCandle);\n          } else if (chartType === 'line' || chartType === 'area') {\n            candlestickSeriesRef.current.update({\n              time: candleStartTime,\n              value: price\n            });\n          }\n          \n          console.log(`ðŸ†• New candle created at ${new Date(candleStartTime * 1000).toISOString()}`);\n        } catch (error) {\n          console.error('Failed to create new candle:', error);\n        }\n      } else {\n        // Update existing candle\n        const updatedCandle = {\n          time: lastCandle.time,\n          open: lastCandle.open,\n          high: Math.max(lastCandle.high, price),\n          low: Math.min(lastCandle.low, price),\n          close: price,\n          volume: Math.max(lastCandle.volume, parseFloat(data.volume || 0))\n        };\n        \n        try {\n          if (chartType === 'candlestick') {\n            candlestickSeriesRef.current.update(updatedCandle);\n          } else if (chartType === 'line' || chartType === 'area') {\n            candlestickSeriesRef.current.update({\n              time: lastCandle.time,\n              value: price\n            });\n          }\n        } catch (error) {\n          console.error('Failed to update candle:', error);\n        }\n      }\n    }\n  }, [symbol, chartData, timeframe, chartType, timeframes]);\n\n  // Handle historical data from WebSocket\n  const handleHistoricalData = useCallback((data) => {\n    if (data.data?.data) {\n      const ohlcData = data.data.data.map(item => ({\n        time: Math.floor(new Date(item.date).getTime() / 1000),\n        open: parseFloat(item.open),\n        high: parseFloat(item.high),\n        low: parseFloat(item.low),\n        close: parseFloat(item.close),\n        volume: parseFloat(item.volume || 0)\n      })).sort((a, b) => a.time - b.time);\n      \n      if (ohlcData.length > 0) {\n        setChartData(ohlcData);\n        updateChartSeries(ohlcData);\n        setCurrentPrice(ohlcData[ohlcData.length - 1].close);\n        \n        // Auto-size chart for WebSocket historical data\n        autoSizeChart('websocket_data');\n      }\n    }\n  }, [updateChartSeries, autoSizeChart]);\n\n  // Handle trading signals\n  const handleTradingSignal = useCallback((data) => {\n    if (data.signal) {\n      addTradeSignal(data.signal);\n      if (onSignalReceived) {\n        onSignalReceived(data.signal);\n      }\n    }\n  }, [onSignalReceived]);\n\n  // Add trade signal marker\n  const addTradeSignal = useCallback((signal) => {\n    if (!candlestickSeriesRef.current) return;\n    \n    const marker = {\n      time: signal.time || Math.floor(Date.now() / 1000),\n      position: signal.type === 'buy' ? 'belowBar' : 'aboveBar',\n      color: signal.type === 'buy' ? '#26a69a' : '#ef5350',\n      shape: signal.type === 'buy' ? 'arrowUp' : 'arrowDown',\n      text: `${signal.type.toUpperCase()}${signal.price ? `: $${signal.price}` : ''}`,\n      size: signal.strength || 1,\n    };\n    \n    setTradeSignals(prev => {\n      const newSignals = [...prev, marker];\n      candlestickSeriesRef.current.setMarkers(newSignals);\n      return newSignals;\n    });\n  }, []);\n\n  // Update indicators\n  const updateIndicators = useCallback((ohlcData) => {\n    if (!chartRef.current || !ohlcData.length) return;\n\n    // Clear existing indicators\n    Object.keys(indicatorSeriesRefs.current).forEach(key => {\n      const series = indicatorSeriesRefs.current[key];\n      if (series) {\n        try {\n          chartRef.current.removeSeries(series);\n        } catch (e) {\n          // Series may already be removed\n        }\n      }\n    });\n    indicatorSeriesRefs.current = {};\n\n    // Add enabled indicators\n    Object.entries(indicators).forEach(([key, config]) => {\n      if (!config.enabled || !config.visible || key === 'volume') return;\n\n      try {\n        if (key === 'sma20' || key === 'sma50') {\n          const period = config.period;\n          const smaData = calculateSMA(ohlcData, period);\n          if (smaData.length > 0) {\n            const series = chartRef.current.addLineSeries({\n              color: config.color,\n              lineWidth: 2,\n              title: `SMA ${period}`,\n              lastValueVisible: true,\n              priceLineVisible: false,\n            });\n            series.setData(smaData);\n            indicatorSeriesRefs.current[key] = series;\n          }\n        } else if (key === 'ema12' || key === 'ema26') {\n          const period = config.period;\n          const emaData = calculateEMA(ohlcData, period);\n          if (emaData.length > 0) {\n            const series = chartRef.current.addLineSeries({\n              color: config.color,\n              lineWidth: 2,\n              title: `EMA ${period}`,\n              lastValueVisible: true,\n              priceLineVisible: false,\n            });\n            series.setData(emaData);\n            indicatorSeriesRefs.current[key] = series;\n          }\n        }\n      } catch (error) {\n        console.error(`Error adding indicator ${key}:`, error);\n      }\n    });\n  }, [indicators]);\n\n  // Technical analysis functions\n  const calculateSMA = (data, period) => {\n    const result = [];\n    for (let i = period - 1; i < data.length; i++) {\n      let sum = 0;\n      for (let j = 0; j < period; j++) {\n        sum += data[i - j].close;\n      }\n      result.push({\n        time: data[i].time,\n        value: parseFloat((sum / period).toFixed(2)),\n      });\n    }\n    return result;\n  };\n\n  const calculateEMA = (data, period) => {\n    const result = [];\n    const multiplier = 2 / (period + 1);\n    let ema = data[0]?.close || 0;\n    \n    for (let i = 0; i < data.length; i++) {\n      if (i === 0) {\n        ema = data[i].close;\n      } else {\n        ema = (data[i].close * multiplier) + (ema * (1 - multiplier));\n      }\n      \n      result.push({\n        time: data[i].time,\n        value: parseFloat(ema.toFixed(2)),\n      });\n    }\n    return result;\n  };\n\n  // Control functions\n  const changeTimeframe = useCallback((newTimeframe) => {\n    console.log(`ðŸ“Š Changing timeframe from ${timeframe} to ${newTimeframe}`);\n    setTimeframe(newTimeframe);\n    \n    // Reset period to first available option for new timeframe\n    const periodOptions = getPeriodOptions(newTimeframe);\n    setSelectedPeriod(periodOptions[0]?.value || '1d');\n    \n    // Auto-resize chart for new timeframe after data loads\n    setTimeout(() => autoSizeChart('timeframe_change'), 500);\n  }, [timeframe, getPeriodOptions, autoSizeChart]);\n\n  const changeChartType = useCallback((newType) => {\n    console.log(`ðŸ“Š Changing chart type from ${chartType} to ${newType}`);\n    setChartType(newType);\n    \n    // Auto-resize chart for new chart type\n    setTimeout(() => autoSizeChart('chart_type_change'), 200);\n  }, [chartType, autoSizeChart]);\n\n  const changePeriod = useCallback((newPeriod) => {\n    console.log(`ðŸ“Š Changing period from ${selectedPeriod} to ${newPeriod}`);\n    setSelectedPeriod(newPeriod);\n    \n    // Auto-resize chart for new period after data loads\n    setTimeout(() => autoSizeChart('period_change'), 500);\n  }, [selectedPeriod, autoSizeChart]);\n\n  const toggleIndicator = useCallback((indicator) => {\n    setIndicators(prev => ({\n      ...prev,\n      [indicator]: {\n        ...prev[indicator],\n        enabled: !prev[indicator].enabled,\n      },\n    }));\n  }, []);\n\n  // Get connection status indicator\n  const getConnectionIndicator = () => {\n    switch (connectionStatus) {\n      case 'connected':\n        return { color: 'bg-green-400', text: 'Live WebSocket' };\n      case 'polling':\n        return { color: 'bg-yellow-400', text: 'Live Polling' };\n      case 'error':\n        return { color: 'bg-red-400', text: 'Connection Error' };\n      default:\n        return { color: 'bg-gray-400', text: 'Disconnected' };\n    }\n  };\n\n  const connectionInfo = getConnectionIndicator();\n\n  return (\n    <div className=\"bg-gray-900 rounded-lg border border-gray-700 flex flex-col h-full\">\n      {/* Chart Header */}\n      <div className=\"flex items-center justify-between p-3 border-b border-gray-700 bg-gray-800 flex-wrap gap-2\">\n        <div className=\"flex items-center space-x-4 flex-wrap\">\n          {/* Symbol Selector */}\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setShowSymbolSearch(true)}\n              className=\"flex items-center space-x-2 px-3 py-1 rounded-md hover:bg-gray-700 transition-colors\"\n            >\n              <h3 className=\"text-lg font-semibold text-white\">{displaySymbol}</h3>\n              <svg className=\"w-4 h-4 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n              </svg>\n            </button>\n          </div>\n\n          {/* Live Price Display */}\n          {currentPrice && (\n            <div className=\"flex items-center space-x-2\">\n              <span className=\"text-lg font-mono font-bold text-white\">\n                ${typeof currentPrice === 'number' ? currentPrice.toFixed(2) : currentPrice}\n              </span>\n              <span className={`text-sm font-medium ${\n                priceChange > 0 ? 'text-green-400' : priceChange < 0 ? 'text-red-400' : 'text-gray-400'\n              }`}>\n                {priceChange > 0 ? '+' : ''}{priceChange.toFixed(2)} ({((priceChange / currentPrice) * 100).toFixed(2)}%)\n              </span>\n            </div>\n          )}\n\n          {/* Timeframe Selector */}\n          <div className=\"flex items-center space-x-2\">\n            <label className=\"text-xs text-gray-400\">Interval:</label>\n            <select\n              value={timeframe}\n              onChange={(e) => changeTimeframe(e.target.value)}\n              className=\"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600 focus:outline-none focus:border-blue-500\"\n            >\n              {timeframes.map((tf) => (\n                <option key={tf.value} value={tf.value}>\n                  {tf.label} - {tf.description}\n                </option>\n              ))}\n            </select>\n          </div>\n            \n          {/* Period Selector */}\n          <div className=\"flex items-center space-x-2\">\n            <label className=\"text-xs text-gray-400\">Period:</label>\n            <select\n              value={selectedPeriod}\n              onChange={(e) => changePeriod(e.target.value)}\n              className=\"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600 focus:outline-none focus:border-green-500\"\n            >\n              {getPeriodOptions(timeframe).map((period) => (\n                <option key={period.value} value={period.value}>\n                  {period.label} ({period.bars} bars)\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n        \n        {/* Right side controls */}\n        <div className=\"flex items-center space-x-2 flex-wrap\">\n          {/* Data Source Indicator */}\n          <div className=\"flex items-center space-x-2 text-xs\">\n            <span className=\"text-gray-400\">Source:</span>\n            <span className={`px-2 py-1 rounded text-xs ${\n              dataSource === 'live' ? 'bg-green-600 text-white' :\n              dataSource === 'cached' ? 'bg-yellow-600 text-white' :\n              dataSource === 'fallback' ? 'bg-orange-600 text-white' :\n              'bg-red-600 text-white'\n            }`}>\n              {dataSource.toUpperCase()}\n            </span>\n          </div>\n          \n          {/* Chart Type */}\n          <div className=\"flex items-center space-x-2\">\n            <label className=\"text-xs text-gray-400\">Type:</label>\n            <select\n              value={chartType}\n              onChange={(e) => changeChartType(e.target.value)}\n              className=\"bg-gray-700 text-white text-xs px-2 py-1 rounded border border-gray-600 focus:outline-none focus:border-purple-500\"\n            >\n              <option value=\"candlestick\">Candlestick</option>\n              <option value=\"line\">Line</option>\n              <option value=\"area\">Area</option>\n            </select>\n          </div>\n          \n          {/* Play/Pause */}\n          <button\n            onClick={() => setIsPlaying(!isPlaying)}\n            className=\"p-2 rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors\"\n            title={isPlaying ? 'Pause' : 'Resume'}\n          >\n            {isPlaying ? (\n              <PauseIcon className=\"w-4 h-4 text-white\" />\n            ) : (\n              <PlayIcon className=\"w-4 h-4 text-white\" />\n            )}\n          </button>\n\n          {/* Refresh Button */}\n          <button\n            onClick={() => fetchMarketData(true)}\n            disabled={isLoading}\n            className=\"p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors disabled:opacity-50\"\n            title=\"Refresh Data\"\n          >\n            <svg className={`w-4 h-4 text-gray-300 ${isLoading ? 'animate-spin' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n            </svg>\n          </button>\n        </div>\n      </div>\n\n      {/* Indicators Panel */}\n      <div className=\"p-2 border-b border-gray-700 bg-gray-850\">\n        <div className=\"flex flex-wrap gap-2 items-center\">\n          {Object.entries(indicators).map(([key, config]) => (\n            config.enabled && key !== 'volume' && (\n              <button\n                key={key}\n                onClick={() => toggleIndicator(key)}\n                className={`px-2 py-1 text-xs rounded border transition-colors ${\n                  config.visible\n                    ? 'bg-blue-600 border-blue-600 text-white'\n                    : 'bg-transparent border-gray-600 text-gray-400 hover:border-blue-500'\n                }`}\n                style={{ borderColor: config.visible ? config.color : undefined }}\n              >\n                <span \n                  className=\"inline-block w-2 h-2 rounded-full mr-1\" \n                  style={{ backgroundColor: config.color }}\n                />\n                {key.toUpperCase()}\n              </button>\n            )\n          ))}\n        </div>\n      </div>\n\n      {/* Chart Container */}\n      <div className=\"flex-1 relative\">\n        <div \n          ref={chartContainerRef}\n          className=\"absolute inset-0\"\n        />\n        \n        {/* Loading Overlay */}\n        {isLoading && (\n          <div className=\"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center\">\n            <div className=\"bg-gray-800 p-4 rounded-lg flex items-center space-x-3\">\n              <svg className=\"animate-spin h-5 w-5 text-blue-500\" fill=\"none\" viewBox=\"0 0 24 24\">\n                <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n              </svg>\n              <span className=\"text-white\">Loading market data...</span>\n            </div>\n          </div>\n        )}\n      </div>\n      \n      {/* Chart Footer */}\n      <div className=\"p-3 border-t border-gray-700 bg-gray-800\">\n        <div className=\"flex items-center justify-between text-xs text-gray-400\">\n          <div className=\"flex items-center space-x-4\">\n            <span className=\"flex items-center\">\n              <span className={`w-2 h-2 ${connectionInfo.color} rounded-full mr-1`}></span>\n              {connectionInfo.text}\n            </span>\n            <span>Interval: {timeframe}</span>\n            <span>Updates: {updateCount}</span>\n          </div>\n          <div className=\"flex items-center space-x-4\">\n            <span>Bars: {chartData.length}</span>\n            <span>Signals: {tradeSignals.length}</span>\n            <span>Last: {new Date().toLocaleTimeString()}</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Dynamic Symbol Search Modal */}\n      <DynamicSymbolSearch\n        isOpen={showSymbolSearch}\n        onClose={() => setShowSymbolSearch(false)}\n        onSymbolSelect={(newSymbol, newDisplaySymbol) => {\n          if (onSymbolChange) onSymbolChange(newSymbol, newDisplaySymbol);\n        }}\n        currentSymbol={symbol}\n      />\n    </div>\n  );\n};\n\nexport default TradingChartV3;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}